@model Models.ViewModels.LibroVM

<!-- Modal de agregar libro -->

<form asp-action="CrearLibro" method="post" enctype="multipart/form-data">
    @Html.AntiForgeryToken()
    <div class="modal-header"
         style="background-color: #8C2445; color: white; font-weight: bold; height: 100px; position: relative;">
        <h1 class="modal-title fs-2" id="staticBackdropLabel"
            style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 200px;">
            Agregar libro
        </h1>
        <button type="reset" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" style="position: absolute; top: 65%; left: 95%; transform: translate(-50%, -50%);
               width: 10px;">
        </button>
    </div>
    <div class="modal-body">
        <div class="container">
            <div class="row">
                <div class="col columnaIzq">
                    <h4 class="titulo-imagen">Imagen</h4>
                    <!-- Input oculto para la imagen-->
                    <input asp-for="Imagen" type="file" id="fileInput" accept="image/*" hidden onchange="previewImage(event)" />

                    <!-- Área interactiva -->
                    <div class="image-placeholder text-center border rounded p-4 w-100 h-75"
                         id="imagePreview"
                         onclick="document.getElementById('fileInput').click();"
                         style="cursor: pointer; width: 300px; height: 400px; overflow: hidden; display: flex; align-items: center; justify-content: center;">

                        @if (!string.IsNullOrEmpty(Model?.Libro?.ImagenUrl))
                        {
                            <img src="~/Images/Libros/@Model.Libro.ImagenUrl"
                                 class="img-fluid w-100 h-100 object-fit-cover rounded"
                                 alt="Imagen actual" />
                        }
                        else
                        {
                            <div class="text-center">
                                <i class="bi bi-plus-lg" style="font-size: 2rem; color: #8C2445;"></i>
                                <label asp-for="Imagen" class="mt-2 text-muted d-block">Haz clic para subir una imagen</label>
                            </div>
                        }
                    </div>
                </div>

                <div class="col columnaDere">
                    <h3 class="titulo-datos">Datos</h3>
                    <div class="form-group mb-3">
                        <label asp-for="Libro.Titulo">Título</label>
                        <input asp-for="Libro.Titulo" type="text" class="form-control">
                        <span asp-validation-for="Libro.Titulo"></span>
                    </div>
                    <div class="form-group mb-3">
                        <label asp-for="Libro.ISBN">ISBN</label>
                        <input asp-for="Libro.ISBN" type="text" class="form-control">
                        <span asp-validation-for="Libro.ISBN"></span>
                    </div>
                    <div class="form-group mb-3">
                        <label asp-for="Libro.FechaPublicacion" for="usr">Fecha de publicación</label>
                        <input asp-for="Libro.FechaPublicacion" type="date" class="form-control">
                        <span asp-validation-for="Libro.FechaPublicacion"></span>
                    </div>
                    <div class="form-group mb-3">
                        <label asp-for="Libro.ClasificacionEdad">Clasificación de Edad</label>
                        <input asp-for="Libro.ClasificacionEdad" type="text" class="form-control">
                        <span asp-validation-for="Libro.ClasificacionEdad"></span>
                    </div>
                    <div class="form-group mb-3">
                        <label asp-for="Libro.Stock">Stock</label>
                        <input asp-for="Libro.Stock" type="text" class="form-control">
                        <span asp-validation-for="Libro.Stock"></span>
                    </div>
                    <div class="form-group mb-3">
                        <label asp-for="Libro.Descripcion">Descripción</label>
                        <textarea asp-for="Libro.Descripcion" class=" form-control" rows="5" id="comment"></textarea>
                        <span asp-validation-for="Libro.Descripcion"></span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-cancelar" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-agregar-libro">Guardar</button>
                </div>
            </div>
        </div>
    </div>
</form>
<script>
    function previewImage(event) {
        const file = event.target.files[0];
        const preview = document.getElementById('imagePreview');

        if (file && file.type.startsWith("image/")) {
            // Validar tamaño del archivo (5MB máximo)
            if (file.size > 5 * 1024 * 1024) {
                alert('El archivo no puede superar los 5MB.');
                event.target.value = '';
                return;
            }

            // Validar extensiones permitidas
            const allowedExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.bmp'];
            const fileName = file.name.toLowerCase();
            const isValidExtension = allowedExtensions.some(ext => fileName.endsWith(ext));
            
            if (!isValidExtension) {
                alert('Solo se permiten archivos de imagen (jpg, jpeg, png, gif, bmp).');
                event.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                preview.innerHTML = `<img src="${e.target.result}" class="img-fluid w-100 h-100 object-fit-cover rounded" alt="Imagen previa">`;
            };
            reader.readAsDataURL(file);
        } else {
            alert('Por favor selecciona un archivo de imagen válido.');
            event.target.value = '';
        }
    }
</script>